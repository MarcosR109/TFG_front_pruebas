<div class="slider-container" [class.open]="sliderOpen">
  <!-- Botón de despliegue dentro del slider -->
  <button class="slider-toggle" (click)="toggleSlider()">
    <mat-icon *ngIf="!sliderOpen">chevron_left</mat-icon>
    <mat-icon *ngIf="sliderOpen">chevron_right</mat-icon>
  </button>

  <div class="slider-content">
    <div class="button-row">
      <button mat-icon-button (click)="toggleNotation()">SP/LT</button>
    </div>

    <div class="button-row">
      <button mat-icon-button (click)="togglePreferirSostenidos()">
        <mat-icon *ngIf="this.preferSostenidos">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#000000"
          >
            <path
              d="m240-160 40-160H120l20-80h160l40-160H180l20-80h160l40-160h80l-40 160h160l40-160h80l-40 160h160l-20 80H660l-40 160h160l-20 80H600l-40 160h-80l40-160H360l-40 160h-80Zm140-240h160l40-160H420l-40 160Z"
            />
          </svg>
        </mat-icon>
        <mat-icon *ngIf="!this.preferSostenidos">
          <svg
            height="24px"
            width="24px"
            version="1.1"
            id="_x32_"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="-51.2 -51.2 614.40 614.40"
            xml:space="preserve"
            fill="#000000"
            stroke="#000000"
          >
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g
              id="SVGRepo_tracerCarrier"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke="#CCCCCC"
              stroke-width="1.024"
            ></g>
            <g id="SVGRepo_iconCarrier">
              <style type="text/css">
                .st0 {
                  fill: #000000;
                }
              </style>
              <g>
                <path
                  class="st0"
                  d="M200.438,214.712V0h-71.18v512c0,0,170.389-50.606,236.182-162.99 C424.052,248.893,324.927,139.024,200.438,214.712z M300.508,302.609c-6.37,82.823-100.117,126.984-100.117,126.984v-156.27 C239.449,239.14,305.394,239.14,300.508,302.609z"
                ></path>
              </g>
            </g>
          </svg>
        </mat-icon>
      </button>
    </div>

    <div>
      <div class="button-row">
        <button mat-icon-button (click)="addVelocidad()">
          <mat-icon>add</mat-icon>
        </button>
        <button
          mat-icon-button
          *ngIf="!this.scrollId"
          (click)="startAutoScroll()"
        >
          <mat-icon>play_arrow</mat-icon>
        </button>
        <button
          mat-icon-button
          *ngIf="this.scrollId"
          (click)="resetAutoScroll()"
        >
          <mat-icon>stop</mat-icon>
        </button>
        <button mat-icon-button (click)="substractVelocidad()">
          <mat-icon>remove</mat-icon>
        </button>
      </div>
    </div>

    <div class="button-row">
      <button mat-icon-button (click)="modSemitono(-1)">
        <span>-1</span>
      </button>
      <button mat-icon-button (click)="modSemitono(-this.semitones)">
        <mat-icon>reset</mat-icon>
      </button>
      <button mat-icon-button (click)="modSemitono(+1)">
        <span>+1</span>
      </button>
    </div>
  </div>
</div>

<div class="grid-container">
  <div class="scroll-container">
    <div
      *ngFor="let linea of lines; let index = index"
      class="input-group"
      [style.width]="maxWidth"
    >
      <div class="square-container" [style.width]="maxWidth">
        <mat-card
          class="square"
          *ngFor="let acorde of linea.acordes; let squareIndex = index"
          dndDropzone
          (dndDrop)="onDrop($event, linea, squareIndex)"
        >
          <!-- Botón "x" para limpiar el contenido textual (solo visible si hay contenido) -->
          <button
            *ngIf="acorde.acorde != 'aux' && !block"
            class="delete-button"
            (click)="eliminarAcorde(linea.n_linea, squareIndex)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              height="15px"
              viewBox="0 -960 960 960"
              width="15px"
              fill="#999999"
            >
              <path
                d="m291-240-51-51 189-189-189-189 51-51 189 189 189-189 51 51-189 189 189 189-51 51-189-189-189 189Z"
              />
            </svg>
          </button>
          <!-- Contenido del acorde -->
          <div class="square-content">
            <app-acordeshow
              *ngIf="acorde.acorde != 'aux'"
              [chord]="acorde.acorde || ''"
              [variacion]="acorde.variacion || ''"
              [semitones]="this.semitones"
            ></app-acordeshow>
          </div>
        </mat-card>
      </div>
      <!-- Campo de entrada de texto -->
      <mat-form-field
        *ngIf="!block"
        appearance="outline"
        class="input-field"
        [style.width]="maxWidth"
      >
        <input
          matInput
          [(ngModel)]="linea.texto"
          placeholder="Texto recibido"
        />
      </mat-form-field>

      <!-- Texto plano cuando this.block es true -->
      <div *ngIf="block" class="plaintext">
        <p class="text-material-design">
          {{ linea.texto }}
        </p>
      </div>

      <div class="button-container" *ngIf="!block">
        <button
          mat-raised-button
          class="add-line-btn"
          color="secondary"
          (click)="agregarLineaDebajo(index)"
        >
          +
        </button>
        <button
          mat-raised-button
          color="secondary"
          class="delete-line-btn"
          (click)="eliminarLinea(index)"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="20px"
            viewBox="0 0 24 24"
            width="20px"
            fill="#000000"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path
              d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
<aside *ngIf="!block">
  <div class="contenedor">
    <!-- Contenedor de Acordes (Expandible con animación) -->
    <div
      class="acordes-container"
      [@expandir]="tonalidadExpandida ? 'expandido' : 'colapsado'"
    >
      <div
        *ngFor="
          let acorde of getAcordesDeTonalidad(tonalidadExpandida);
          trackBy: trackByAcorde
        "
        class="acorde-box"
        [dndDraggable]="acorde"
      >
        {{ acorde.acorde }}
      </div>
    </div>

    <!-- Lista de Tonalidades -->
    <div class="tonalidades-container">
      <div
        *ngFor="let tonalidad of tonalidades"
        class="tonalidad-box"
        [class.seleccionada]="tonalidadExpandida === tonalidad"
        (click)="seleccionarTonalidad(tonalidad)"
      >
        {{ tonalidad }}
      </div>
    </div>
  </div>
</aside>
<div *ngIf="!block" class="variaciones-container" [class.arriba]="menuArriba">
  <div class="variaciones-slider">
    <button
      *ngFor="let variacion of variaciones"
      class="variacion-btn"
      [dndDraggable]="variacion"
    >
      {{ variacion }}
    </button>
  </div>
</div>
<div *ngIf="!block && !revision && !edicion" class="submit-container">
  <button
    [disabled]="this.cancion?.lineas?.length === 0"
    mat-raised-button
    color="primary"
    (click)="enviarCancion()"
  >
    Enviar canción
  </button>
</div>
<div *ngIf="!block && revision" class="submit-container">
  <button
    [disabled]="this.cancion?.lineas?.length === 0"
    mat-raised-button
    color="primary"
    (click)="editarCancion()"
  >
    Terminar revisión
  </button>
</div>
<div *ngIf="!block && edicion" class="submit-container">
  <button
    [disabled]="this.cancion?.lineas?.length === 0"
    mat-raised-button
    color="primary"
    (click)="editarCancion()"
  >
    Editar
  </button>
</div>
